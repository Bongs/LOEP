<p class="survey_title">LOEM Evaluation Survey</p>

<% @evmethodItems.each_with_index do |item,i| %>
  <%nItem = i+1%>
  <%itemName = "item" + nItem.to_s%>
  <%iValue = @evaluation.send(itemName)%>

  <div class="survey_block" item="<%=nItem%>">
    <p class="survey_question_title"><%=nItem%>. <%=item[0]%></p>
    <p class="survey_question_subtitle"><%=item[1]%></p>
    
    <div class="rating_wrapper">
      <div class="rating_wrapper_column1">
        <%= f.hidden_field itemName, :value => iValue %>
        <%= render itemName, :f => f , :value=> iValue, :readonly => readonly %>
      </div>

      <div class="rating_wrapper_column2">
      	<div class='numberCircle'>
          <span>
      		  <% unless iValue.nil? %>
              <%=iValue %>
            <% end %>
          </span>
      	</div>
        <div class="remove_item-value" onclick='onClickRemoveForItem(<%=nItem%>)'><span class="glyphicon glyphicon glyphicon-remove"></span> Remove</div>
      </div>
    </div>
  </div>

<% end %>

<div class="survey_block">
  <p class="survey_question_title">Additional Comments</p>
  <p class="survey_question_subtitle">Please, write here any further comments that you consider relevant and/or necessary for this evaluation</p>
  <%= f.text_area :comments, :class=>'loep_input optionalInput', :readonly => readonly ? "true" : nil %>
</div>

<div class="survey_block">
  <p class="survey_question_title">Overall Score</p>
  <p class="survey_question_subtitle">Optionally, you may propose an overall score between 0.0 and 10.0 for this Learning Object.</p>
  <%= f.number_field :score, :class=>'loep_input optionalInput', :step=> 0.1, :min=>0, :max=>10, :readonly => readonly ? "true" : nil %>
</div>

<% if !readonly %>
  <script type="text/javascript">
    var updateValueForItem = function(item,value){
      var circleDOM = $("div.survey_block[item='"+item+"'] div.numberCircle span");
      if((typeof value == "string")&&(value.trim()!="")){
        $(circleDOM).html(value);
        $("#evaluations_loem_item"+item).attr("value",value);
        showRemoveButtonForItem(item);
      } else {
        $(circleDOM).html("");
        $("#evaluations_loem_item"+item).removeAttr("value");
        showRemoveButtonForItem(item,false);
      }
    };

    var showRemoveButtonForItem = function(item,show){
      show = (typeof show == "boolean" ? show : true);
      var removeButton = $("div.survey_block[item='"+item+"'] div.remove_item-value");
      isVisible = $(removeButton).is(":visible");
      if(show){
        if(!isVisible){
          $(removeButton).fadeIn().css("display","inline-block");
        }
      } else {
        if(isVisible){
          $(removeButton).fadeOut();
        }
      }      
    };

    var onClickRemoveForItem = function(item){
      var surveyBlock = $("div.survey_block[item='"+item+"']");

      //Disable checkboxs
      $("div.survey_block[item='"+item+"']").find("input[type='checkbox']").removeAttr("checked");

      //Remove value
      updateValueForItem(item,undefined);
    };
  </script>
<% end %>