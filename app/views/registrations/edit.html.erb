<div class="loep_form_wrapper">
  <h2>Settings</h2>

  <% devise_error_messages!.each do |msg| %>
      <% if msg.is_a?(String) %>
        <div class="alert alert-danger"><%= msg %></div>
      <% end %>
  <% end %>

  <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put }) do |f| %>

      <p class="form_legend">Username</p>
      <%=text_field_tag "user[name]",@user.name, :class=>'loep_input' %>

      <p class="form_legend">Email</p>
      <%= f.email_field :email, :class=>'loep_input' %>

      <p class="form_legend">Birthday</p>
      <%=text_field_tag "user[birthday]",@user.readable_birthday, :class=>'loep_input', :id=>"birthday_datepicker" %>

      <p class="form_legend">Gender</p>
      <div class="gender_buttons">
        <%= f.radio_button :gender, 1 %><span class="gender_label">Male</span>
        <%= f.radio_button :gender, 2 %><span class="gender_label">Female</span>
      </div>

      <p class="form_legend">* Occupation or field of expertise</p>
      <%= f.select :occupation, options_for_select(Utils.getOptionsForOccupation,resource.occupation || "Education"), {} ,{ :class=>'loep_input' } %>

      <p class="form_legend">* Preferred Language</p>
      <%= f.select :language_id, options_for_select(Utils.getOptionsForSelectLan(resource),resource.language_id || "Unspecified"), {} ,{ :class=>'loep_input' } %>

      <p class="form_legend">* All Languages</p>
      <%= f.select :languages, options_for_select(Utils.getOptionsForSelectLan(resource,{:multiple => true}),resource.getLanguages), {} ,{ :multiple => 'true' , :size => 6, :class=>'loep_input' } %>


      <p class="form_legend">Areas of interest</p>
      <input name="user[tag_list]" id="tags" value="<%=@user.tag_list.join(",")%>"/>

      <p class="form_legend">Password (leave blank if you don't want to change it)</p>
      <%= f.password_field :password, :autocomplete => "off", :class=>'loep_input' %>

      <p class="form_legend">Password confirmation</p>
      <%= f.password_field :password_confirmation, :class=>'loep_input' %>

      <p class="form_legend">Current password (we need your current password to confirm your changes)</p>
      <%= f.password_field :current_password, :class=>'loep_input' %>

      <p class="form_before_button">&nbsp;</p>
      <%= f.submit "Update", :class => 'loep_button update_button' %>

  <% end %>

  </br>
  <%= link_to "Back", :back %>

  </br>
  </br>
  <h3>Cancel my account</h3>
  <p>
    <% unless @user.role?("SuperAdmin") %>
      <%= button_to "Cancel", registration_path(resource_name), :class => 'loep_button cancel_button', :data => { :confirm => "Are you sure?" }, :method => :delete %>
    <% else %>
      <input class="loep_button cancel_button" data-confirm="You are the SuperAdmin, you can't cancel your account." type="submit" promptOkAlertDialog="true" value="Cancel">
    <% end %>
  </p>
</div>

<script type="text/javascript">
  jQuery(document).ready(function($){
    $('#birthday_datepicker').datepicker({ 
      yearRange: "-100:+0", // this is the option you're looking for
      showOn: "both", 
      dateFormat : 'dd/mm/yy',
      changeMonth : true,
      changeYear : true,
      maxDate: '-1d',
      buttonImage: "/assets/calendar_icon.png", 
      buttonImageOnly: true 
    });

    $('#tags').tagsInput({
      autocomplete_url:'http://localhost:3000/tags',
      'minChars' : 2,
      'maxChars' : 25 //if not provided there is no limit,
    });

    //Little fix for select input
    $("#user_language_id").attr("style","width:" + $("#user_language_id").width() + "px");
    $("#user_language_id").select2({
        minimumResultsForSearch: -1
      }
    );

    $("#user_language_id").on("select2-selecting", function(event) {
      var valueSelected = event.val;
      var userLanguagesVal = $("#user_languages").val();
      if((userLanguagesVal == null) || (userLanguagesVal.indexOf(valueSelected)==-1)){
        if(userLanguagesVal == null){
          userLanguagesVal = [];
        }
        userLanguagesVal.push(valueSelected);
        $("#user_languages").val(userLanguagesVal).trigger("change");
      }

    });

    $("#user_languages").attr("style","width:" + $("#user_languages").width() + "px");
    $("#user_languages").select2();

  });
</script>
